Базово, операции в ЛЛМ делятся на 3 категории: линейные проекции (Q,K,V etc), поэлементные операции (леернорм, резидуал) и вычисление аттеншена. Линейные проекции и поэлементные операции элементарно батчатся, увеличивая [[Arithmetic Intensity]]. С вычислением аттеншена появляются проблемы: если у нас есть два токена $t_1$ и $t_2$ из разных последовательностей, то это означает, что их кэши $K_1, K_2, V_1, V_2$ тоже разные. Соответственно, при вычислении $Softmax(q_iK_i^t)V_i$ мы можем максимум воспользоваться параллельностью, но не батчингом.
# Static Batching
Самый элементарный способ батчинга. Берем наши последовательности, паддим *слева*, генерируем токены. Проблема в том, что длины итоговых генераций получатся разными, и в какой-то момент времени нам придется выкидывать из вычислений законченные последовательности, тем самым ухудшая утилизацию.
# Continuous Batching
